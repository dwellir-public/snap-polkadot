#!/bin/sh

BASE_PATH="$SNAP_COMMON/polkadot_base"
SERVICE_ARGS_FILE="$SNAP_COMMON/service-arguments"

set_service_args()
{
    snapctl set service-args="$1"
}

get_service_args()
{
    service_args="$(snapctl get service-args)"
    if [ -z "$service_args" ]; then
        logger -t ${SNAP_NAME} "Setting default service args"
        service_args="--name=$(hostname)"
        set_service_args $service_args
    fi
    echo "$service_args"
}

handle_service_args_config()
{
    service_args="$(get_service_args)"
    logger -t ${SNAP_NAME} "Current service args: $service_args"
    # TODO --base-path is not allowed to be set. Validate and remove or reject change if so.
    set_service_args $service_args
    logger -t ${SNAP_NAME} "Writing --base-path=$BASE_PATH and $service_args to $SERVICE_ARGS_FILE"
    echo "--base-path=$BASE_PATH $service_args" > "$SERVICE_ARGS_FILE"
    snapctl restart ${SNAP_NAME}
}

handle_service_args_config
